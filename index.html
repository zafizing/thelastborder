<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>STRATEGIC MAP v4.1 OFFLINE</title>
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden;font-family:Courier}
#container{position:absolute;transform-origin:0 0}
canvas{position:absolute;top:0;left:0;image-rendering:pixelated}
#ui{
position:fixed;top:20px;left:20px;z-index:9999;
background:rgba(10,10,10,.9);
border:1px solid #ff4500;
padding:15px;width:240px;color:#ff4500
}
select{width:100%;padding:8px;background:#000;color:#ff4500;border:1px solid #ff4500}
button{width:100%;margin-top:10px;background:none;border:1px solid #444;color:#444}
</style>
</head>
<body>

<div id="ui">
<h3>STRATEGIC MAP v4.1</h3>
<select id="nation">
<option value="tr">TÃœRKÄ°YE ðŸ‡¹ðŸ‡·</option>
<option value="az">AZERBAYCAN ðŸ‡¦ðŸ‡¿</option>
</select>
<button onclick="localStorage.clear();location.reload()">PURGE DATA</button>
</div>

<div id="container">
<canvas id="map" width="4000" height="2000"></canvas>
<canvas id="paint" width="4000" height="2000"></canvas>
</div>

<script>
const W=4000,H=2000,SLOT=20;
const map=document.getElementById("map");
const paint=document.getElementById("paint");
const mctx=map.getContext("2d");
const pctx=paint.getContext("2d");
pctx.imageSmoothingEnabled=false;

const container=document.getElementById("container");
const nation=document.getElementById("nation");

let scale=0.4;
let ox=(window.innerWidth-W*scale)/2;
let oy=(window.innerHeight-H*scale)/2;

let drag=false,sx,sy,moved=false;
let grid=JSON.parse(localStorage.getItem("world_v41")||"{}");

function update(){container.style.transform=`translate(${ox}px,${oy}px) scale(${scale})`;}

window.onwheel=e=>{
e.preventDefault();
const z=e.deltaY<0?1.1:0.9;
const old=scale;
scale=Math.min(Math.max(0.1,scale*z),8);
ox=e.clientX-(e.clientX-ox)*(scale/old);
oy=e.clientY-(e.clientY-oy)*(scale/old);
update();
};

window.onmousedown=e=>{
if(e.target.closest("#ui"))return;
drag=true;sx=e.clientX;sy=e.clientY;moved=false;
};
window.onmousemove=e=>{
if(!drag)return;
if(Math.hypot(e.clientX-sx,e.clientY-sy)>2)moved=true;
ox+=e.clientX-sx;oy+=e.clientY-sy;
sx=e.clientX;sy=e.clientY;
update();
};
window.onmouseup=e=>{
if(drag&&!moved)deploy(e);
drag=false;
};

function drawBaseMap(){
mctx.fillStyle="#000";
mctx.fillRect(0,0,W,H);

// basit kara alan simÃ¼lasyonu (offline world silhouette)
mctx.fillStyle="#555";
mctx.fillRect(200,200,3600,1600);
}

function isLand(x,y){
const p=mctx.getImageData(x,y,1,1).data;
return p[0]>50;
}

function deploy(e){
const x=(e.clientX-ox)/scale;
const y=(e.clientY-oy)/scale;
if(!isLand(x,y))return;
const c=Math.floor(x/SLOT);
const r=Math.floor(y/SLOT);
grid[c+","+r]=nation.value;
localStorage.setItem("world_v41",JSON.stringify(grid));
render();
}

function render(){
pctx.clearRect(0,0,W,H);
for(const k in grid){
const [c,r]=k.split(",").map(Number);
pctx.fillStyle=grid[k]==="tr"?"#E30A17":"#00b5e2";
pctx.fillRect(c*SLOT,r*SLOT,SLOT,SLOT);
}
}

drawBaseMap();
render();
update();
</script>
</body>
</html>
